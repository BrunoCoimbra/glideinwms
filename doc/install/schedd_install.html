<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>Installation of a scheduler node in the glideinWMS</TITLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1><FONT FACE="Bitstream Vera Serif"><FONT SIZE=4>Installation of a
scheduler node in the glideinWMS </FONT></FONT>
</H1>
<hr>
<table>
<tr valign="center" align="center">
<td>[</td><td><a href="#description">Description</a></td>
<td>|</td><td><a href="#hardware">Hardware requirements</a></td>
<td>|</td><td><a href="#software">Needed software</a></td>
<td>|</td><td><a href="#condor">Installation instructions</a></td>
<td>|</td><td><a href="#submit">Submitting user jobs</a></td>
<td>]</td>
</tr>
</table>
<hr>
<TABLE CELLPADDING=2 CELLSPACING=2>
	<TR>
		<TD VALIGN=TOP>
                        <A NAME="description">
			<H2><FONT FACE="Bitstream Vera Serif"><FONT SIZE=4>1. Description </FONT></FONT>
			</H2>
			<P><FONT FACE="Liberation Serif"><FONT SIZE=3>This node will be a
			<A HREF="http://www.cs.wisc.edu/condor/manual/v7.0/3_1Introduction.html#SECTION00411000000000000000">Condor
			Submit node</A> for the user jobs.<BR>You can install many such
			nodes to improve scalability of your system.</FONT></FONT></P>
                        <A NAME="hardware">
			<H2><FONT FACE="Bitstream Vera Serif"><FONT SIZE=4>2. Hardware
			requirements </FONT></FONT>
			</H2>
			<P><FONT FACE="Liberation Serif"><FONT SIZE=3>This machine needs <B>a
			reasonably recent CPUs</B> and <B>a large amount of memory</B>
			(min <B>2GB</B>, recommended <B>16GB</B>, <B>~1.5MB per running
			job</B>).<BR>The amount of <B>disk</B> needed <B>depends on the
			user jobs</B>; Condor itself uses very little (5 GB should be
			enough for Condor alone)</FONT></FONT></P>
                        <A NAME="software">
			<H2><FONT FACE="Bitstream Vera Serif"><FONT SIZE=4>3. Needed
			software </FONT></FONT>
			</H2>
			<P><FONT FACE="Liberation Serif"><FONT SIZE=3>Any <A HREF="http://www.cs.wisc.edu/condor/manual/v7.0/1_5Availability.html">Condor-supported
			OS</A>.<BR>The <A HREF="https://twiki.grid.iu.edu/twiki/bin/view/Documentation/WebHome">OSG
			client software</A>.<BR>The <A HREF="http://www.cs.wisc.edu/condor/downloads/">Condor
			distribution</A>.</FONT></FONT></P>
		</TD>
		<TD>
			<P><IMG SRC="overview_schedd.png" NAME="graphics1" ALIGN=BOTTOM BORDER=0>
						</P>
		</TD>
	</TR>
</TABLE>

<p><font face="Liberation Serif"><font size="3"><strong>NOTE:</strong>
<ul>
  <li>Condor version v7.3.1 has a known issue with incorrect return/exit codes of condor_status and condor_q</li>
  <li>If you are using Condor version v7.3.2 disable VOMS checking in condor_config file used by condor daemons other than that used by user schedd. VOMS checking adds unrequired overhead. To do so, set <br>
  USE_VOMS_ATTRIBUTES = False <br>
  or for individual condor daemons like collector<br>
  COLLECTOR.USE_VOMS_ATTRIBUTES = False <br>
  </li>
</ul>
</p>


<A NAME="condor">
<H2><FONT FACE="Bitstream Vera Serif"><FONT SIZE=4>4. Installation
instructions </FONT></FONT>
</H2>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>The scheduler node
software should be installed as root. While it is possible to run the schedds as a non-privileged user,
it has some serious security implications; see the
<A HREF="http://www.cs.wisc.edu/condor/manual/v7.0/3_6Security.html#sec:Non-Root">Condor manual</A> for details.
<BR>
The whole process is managed by
a install script described below. You will need to provide
a valid <A HREF="http://www.cs.wisc.edu/condor/downloads/">Condor
tarball</A>, so you may as well download it before starting the
installer.</FONT></FONT>
</P>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>Move into</FONT></FONT></P>
<BLOCKQUOTE><FONT FACE="Liberation Serif"><FONT SIZE=3>glideinWMS/install</FONT></FONT></BLOCKQUOTE>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>and execute</FONT></FONT></P>
<BLOCKQUOTE><FONT FACE="Liberation Serif"><FONT SIZE=3>./glideinWMS_install</FONT></FONT></BLOCKQUOTE>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>You will be presented
with this screen:</FONT></FONT></P>
<BLOCKQUOTE><FONT FACE="Liberation Serif"><FONT SIZE=3>What do you
want to install?<BR>(May select several options at one, using a ,
separated list)<BR>[1] glideinWMS Collector<BR>[2] Glidein
Factory<BR>[3] GCB<BR>[4] pool Collector<BR>[5] Schedd node<BR>[6]
Condor for VO Frontend<BR>[7] VO Frontend<BR>[8] Components</FONT></FONT></BLOCKQUOTE>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>Select <B>5</B>.</FONT></FONT></P>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>Now follow the
instructions and install all the software components. Most of the
questions should be fairly straightforward. The part that is not
completely automatic is the configuration of the GSI security; you
will need to provide the DN of the pool collector and the
DN of the glidein factory.</FONT></FONT></P>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>Here a possible set of
answers is presented; your setup will probably be slightly different:</FONT></FONT></P>
<PRE STYLE="margin-left: 0.39in; margin-right: 0.39in; margin-bottom: 0.2in">
Welcome to the glideinWMS Installation Helper

What do you want to install?
(May select several options at one, using a , separated list)
[1] glideinWMS Schedds and Collector
[2] Glidein Factory
[3] GCB
[4] User Pool Collector
[5] User Schedd
[6] Condor for VO Frontend
[7] VO Frontend
[8] Components
Please select: <b>5</b>

The following profiles will be installed:
[5] User Schedd

Installing user submit schedds

Installing condor


You will now need the Condor tarball
You can find it on http://www.cs.wisc.edu/condor/
Versions v7.2.2 and 7.3.1 have been tested, but you
should always use the latest one

Where do you have the Condor tarball? <b>/root/condor-7.4.2-linux-x86_64-rhel5-dynamic.tar.gz</b>
Checking...
Seems condor version 7.4.2

Where do you want to install it?: [/opt/glidecondor] <b>/opt/glidecondor</b>
Directory '/opt/glidecondor' does not exist, should I create it?: (y/n) <b>y</b>
Installing condor in '/opt/glidecondor'

If something goes wrong with Condor, who should get email about it?: <b>admin@my.org</b>
Extracting from tarball
Running condor_configure
Installing Condor from /opt/glidecondor/tar/condor-7.4.2 to /opt/glidecondor

Condor has been installed into:
    /opt/glidecondor

Configured condor using these configuration files:
  global: /opt/glidecondor/etc/condor_config
  local:  /opt/glidecondor/condor_local/condor_config.local
You should look inside the installation log for some details about how
Condor was installed.
Created scripts which can be sourced by users to setup their
Condor environment variables.  These are:
   sh: /opt/glidecondor/condor.sh
  csh: /opt/glidecondor/condor.csh

Do you want to split the config files between condor_config and condor_config.local?: (y/n) [y] <b>y</b>

The Condor config has been put in your login files
Please remember to exit and reenter the terminal after the install

Condor installed

Configuring GSI security

To use the GSI security, you either need a valid GSI proxy or
a valid x509 certificate and relative key
The cert/proxy subject of User Schedd, Glidein Pool Collector and VO Frontend
(used by glidein startd) will be added as the trusted daemon in GSI_DAEMON_NAME 
in the condor configuration.
Will you be using a proxy or a cert? (proxy/cert) <B>cert</B>
Where is your certificate located?: <B>/etc/grid-security/hostcert.pem</B>
Where is your certificate key located?: <B>/etc/grid-security/hostkey.pem</B>
My DN = '/DC=org/DC=doegrids/OU=Services/CN=submit1.my.org'

Glidein Pool Collector and VO Frontend and glidein startd will connect to and
act as client to User Schedd. Subjects for these services should be in the 
gridmap file of the User Schedd.
Please insert all such DNs, together with a user nickname.
An empty DN entry means you are done.
DN: <B>/DC=org/DC=doegrids/OU=Services/CN=collector1.my.org</B>
nickname: [condor001] <B>collector</B>
Is this a trusted Condor daemon?: (y/n) y
DN: <B>/DC=org/DC=doegrids/OU=Service/CN=gfactory/gfactory1.my.org</B>
nickname: [condor002] <B>pilot</B>
Is this a trusted Condor daemon?: (y/n) <B>y</B>
DN: <I>enter</I>
Do you want to Use Quill (works for 6.8.X only)?: (y/n) [n] <B>n</B>
What node is the collector running (i.e. CONDOR_HOST)?: <B>collector1.my.org</B>
Please list all the GCB servers you will be using
Leave an empty line when finished
GCB node:<I>enter</I>
How many secondary schedds do you want?: [9] <B>4</B>

</PRE>

<P STYLE="margin-right: 0.39in">
The installer will also start the Condor daemons.
</P>
<P>The installer also created init.d scripts in
<BLOCKQUOTE><FONT FACE="Liberation Serif">
<FONT SIZE=3>/etc/init.d/condor</FONT></FONT></BLOCKQUOTE>
<P>Use it to stop and restart the schedd(s)</P>
<P>NOTE: Since Schedd node is installed as root, condor installer will
create condor.sh and condor.csh files in /etc/profile.d so that you have correct
environment setup. If this machine hosts another condor installation or you 
prefer not to have user PATH and CONDOR_CONFIG point to this condor setup
automatically, you need to manually move these files out from the /etc/profile.d
<A NAME="submit">
<H2><FONT FACE="Bitstream Vera Serif"><FONT SIZE=4>5. Submitting user
jobs </FONT></FONT>
</H2>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>From the user point of
view, this is just a regular Condor pool.<BR><BR>However, since the
resources potentially come from all over the world, users need to
create more complex <B>Requirements</B>, in order to prevent the jobs
from landing on sites that cannot run their jobs.<BR>Users will need
to know which attributes the glideins publish and use them
accordingly.</FONT></FONT></P>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3><BR>One useful
attribute that all glideins publish is GLIDEIN_Site. If a user wants
to restrict its job to a list of sites, he can do it be using:</FONT></FONT></P>
<BLOCKQUOTE><FONT FACE="Liberation Serif"><FONT SIZE=3>+DESIRED_Sites
= &quot;Site1,Site4,Site7,Site22&quot;<BR>Requirements =
stringListMember(GLIDEIN_Site,DESIRED_Sites)</FONT></FONT></BLOCKQUOTE>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>Some glideins may also
need to properly identify the final user, using GSI authentication. A
user should thus add the following line:</FONT></FONT></P>
<BLOCKQUOTE><FONT FACE="Liberation Serif"><FONT SIZE=3>x509userproxy
= <I>&lt;path to X509 proxy&gt;</I></FONT></FONT></BLOCKQUOTE>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3>to their Condor
submission file.</FONT></FONT></P>

<H3><FONT FACE="Bitstream Vera Serif"><FONT SIZE=4>6. Fine Tunning for Large Scale Installations</FONT></FONT></H3>
<H4><FONT FACE="Utopia, serif"><FONT SIZE=3>6.1 Increase the number of available file descriptors</FONT></FONT></H4>
<P><FONT FACE="Liberation Serif"><FONT SIZE=3><FONT FACE="Liberation Serif"><FONT SIZE=3>Number of ports used by the condor_schedd process increases as the number of jobs running/queued in the schedd increase. The default number of file descriptors per process is 1024 on most systems. Increase this limit to ~16k or value higher than number of jobs that might be in the queue at any given time. This is particularly required for large scale installations. 
<br><br>
In most cases for default installation, user schedd is configured to start as root and started through the script in /etc/xinet.d/condor This is a good place to set higher file descriptor limit for the schedd process.
</p>
<P><A HREF="index.html"><FONT FACE="Liberation Serif"><FONT SIZE=3>Back
to the index</FONT></FONT></A></P>
<hr><P ALIGN=LEFT><b>glideinWMS support:</b> glideinwms-support@fnal.gov</p>
</BODY>
</HTML>
