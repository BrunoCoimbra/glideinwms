<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<head>
 <title>Condor Quill Setup</title>
 <link rel="stylesheet" type="text/css" href="glideinWMS.css" media="screen, projection" />
</head>
<body revision="dmqrsvn_23hgqmcw:92">
    <h1>
        <a href="index.html">Installation Guide</a>
	<ul class="main_links">
        <li><a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/
index.html" class="main_link">Home</a></li>
        <li><a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/
doc.prd/install/" class="main_link">Installation</a></li>
        <li><a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/
doc.prd/manual/" class="main_link">Manual</a></li>
        <li><a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/
download.html" class="main_link">Download</a></li>
        </ul>

    </h1>
    
    <ul class="components">
	<li> <a href="factory_install.html">WMS Collector / Factory </a></li>
	<li> <a href="collector_install.html">Pool Collector </a></li>
	<li> <a href="schedd_install.html">Pool Schedd </a></li>
	<li> <a href="frontend_install.html" >VO Frontend </a></li>
	<li> <a href="troubleshooting.html" class="last">Troubleshooting</a></li>
    </ul>
    <div class="clear" />
    <ul class="topnav">
	<li><a href="#description">Description</a></li>
	<li><a href="#software">Required software</a></li>
	<li><a href="#install">Installation</a></li>
    </ul>
<div class="content">
    <h2 class="header">  Condor Quill setup</h2>

<div class="section">
	<h2><a name="description">1. Description</h2>
	<p>
		This document describes how to configure Condor quill.
	</p>
</div>
<div class="section">
<h2><a name="software">  2. Required software</a></h2>
	<ul>
	<li>
		A reasonably recent Linux OS (SL4 used at press time).
	</li>
	<li>
		A <a href=http://www.postgresql.org/ title="PostgreSQL Hoe Page">
			PostgreSQL server</a>.
	</li>
	<li>
		The
		<a href=http://www.cs.wisc.edu/condor/downloads/ title="Condor download page">
			Condor distribution</a>.<br>
	</li>
	</ul>
</div>
<div class="section">
<h2><a name="install">  3. Installation instructions</a></h2>
	<p>
	The installation will assume you
	<a href="condor_v7.0.5_install.html" title="Condor v7.0.5 Installation">
		have installed Condor v7.0.5
	</a>.
	</p>
	<p>
	The install directory is <b>/opt/glidecondor</b>, the working directory is
	<b>/opt/glidecondor/condor_local</b> and the machine name is 
	<b>mymachine.fnal.gov</b>. and its IP 
	<b>131.225.70.222</b>.
	</p>
	<p>
	If you want to use a different setup, make the necessary changes.
	</p>
	<p>
	Unless explicity mentioned, all operations are to be done as root.
	</p>
</div>
<div class="section">
<h3>  3.1 Obtain and install PostgreSQL RPMs</h3>
	<p>
	Most Linux distributions come with very old versions of PostgreSQL, so you will
	want to download the latest version.
	</p>
	<p>
	The RPMs can be found on
	<a href=http://www.postgresql.org/ftp/binary/ title="PostgreSQL Download page">http://www.postgresql.org/ftp/binary/</a>
	</p>
	<p>
	At the time of writing, the latest version is v8.2.4, and the RPM files to install are
	<blockquote>
	  postgresql-8.2.4-1PGDG.i686.rpm<br>
	  postgresql-libs-8.2.4-1PGDG.i686.rpm<br>
	  postgresql-server-8.2.4-1PGDG.i686.rpm<br>
	</blockquote>
</div>
<div class="section">
<h3>  3.2 Initialize PostgreSQL</h3>
	<p>
	Switch to user postgres:
	<blockquote>
	  su - postgres<br>
	</blockquote>
	And initialize initialize the database with:
	<blockquote>
	  initdb -A "ident sameuser" -D /var/lib/pgsql/data<br>
	</blockquote>
	</p>
</div>
<div class="section">
<h3>  3.3 Configure PostgreSQL</h3>
	<p>
	PostgreSQL by default only accepts local connections., so you need to configure
it in order for Quill to use it.
	</p>
	<p>
	Please do it as user postgres.
	</p>
	<p>
	To enable TCP/IP traffic, you need to change
	<b>listen_addresses</b> in <b>/var/lib/pgsql/data/postgresql.conf</b> to:<br>
	<blockquote>
	  # Make it listen to TCP ports<br>
	  listen_addresses = '*'<br>
	</blockquote>
	</p>
	<p>
	Moreover, you need to specify which machines will be able to access it.<br>
	Unless you have strict security policies forbiding this, I recommend enabling
	read access to the whole world by adding the following line
	to <b>/var/lib/pgsql/data/pg_hba.conf</b>:
	<blockquote>
	  host&nbsp;&nbsp;&nbsp; all&nbsp;&nbsp;&nbsp;&nbsp;
	  quillreader&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0/0
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; md5<br>
	</blockquote>
	On the other hand, we want only the local machine to be able to write the
	database.  So, we will add to
	<b>/var/lib/pgsql/data/pg_hba.conf</b>:
	<blockquote>
	  host&nbsp;&nbsp;&nbsp; all&nbsp;&nbsp;&nbsp;&nbsp;
	  quillwriter&nbsp;&nbsp;&nbsp;&nbsp; 131.225.70.222/32 &nbsp; md5<br>
	</blockquote>
	</p>
</div>
<div class="section">
<h3>  3.4 Start PostgreSQL</h3>
	To start PostgreSQL, just run:
	<blockquote>
	  /etc/init.d/postgresql start<br>
	</blockquote>
	There should be no error messages.
</div>
<div class="section">
<h3>  3.5 Initalize Quill users</h3>
	Switch to user postgres:<br>
	<blockquote>
	  su - postgres<br>
	</blockquote>
	And initialize initialize the Quill users with:<br>
	<blockquote>
  createuser quillreader --no-createdb --no-adduser --no-createrole --pwprompt<br/>
  # passwd <b>reader</b><br/>
  createuser quillwriter --createdb --no-adduser --no-createrole --pwprompt<br/>
  # password &lt;writer passwd&gt;<br/>
  psql -c "REVOKE CREATE ON SCHEMA public FROM PUBLIC;"<br/>
  psql -d template1 -c "REVOKE CREATE ON SCHEMA public FROM PUBLIC;"<br/>
  psql -d template1 -c "GRANT CREATE ON SCHEMA public TO quillwriter; GRANT USAGE ON SCHEMA public TO quillwriter;"<br/>
	</blockquote>
</div>
<div class="section">
<h3>  3.6 Configure Condor</h3>
Append the following lines to
<b>/opt/glidecondor/etc/condor_config</b>:
	<blockquote>
	  #############################<br/>
	  # Quill settings<br/>
	  #############################<br/>
	  QUILL_ENABLED = TRUE<br/>
	  QUILL_NAME = quill@$(FULL_HOSTNAME)<br/>
	  QUILL_DB_NAME = $(HOSTNAME)<br/>
	  QUILL_DB_QUERY_PASSWORD = reader<br/>
	  QUILL_DB_IP_ADDR = $(HOSTNAME):5432<br/>
	  QUILL_MANAGE_VACUUM = TRUE<br/>
	</blockquote>
	In <b>/opt/glidecondor/condor_local/condor_config.local</b>,
	add <b>QUILL</b> to <b>DAEMON_LIST,</b> getting something like:
	<blockquote>
DAEMON_LIST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  = MASTER, QUILL, SCHEDD
	</blockquote>
	Finally, put the writer passwd into
	<b>/opt/glidecondor/condor_local/spool/.quillwritepassword</b>:
	<blockquote>
	  echo "&lt;writer passwd&gt;" &gt;
	  /opt/glidecondor/condor_local/spool/.quillwritepassword<br/>
	  chown condor /opt/glidecondor/condor_local/spool/.quillwritepassword<br/>
	  chmod go-rwx /opt/glidecondor/condor_local/spool/.quillwritepassword<br/>
	</blockquote>
</div>
</div>
<P ALIGN=LEFT><b>glideinWMS support:</b> glideinwms-support@fnal.gov</p>
</body>
</html>
